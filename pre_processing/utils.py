import os, array
import numpy as np
import imageio


def make_byteplot_im(path,name):
    with open(path, 'rb') as f:
        ln = os.path.getsize(path)  # length of file in bytes
        width = 224
        rem = ln % width
        a = array.array("B")  # uint8 array
        a.fromfile(f, ln-rem)

    g = np.reshape(a, (int(len(a)/width), width))
    g = np.uint8(g)
    output_path = "C:/Workdir/Malware-Detection/Data/Benign/"
    imageio.imsave(output_path + name + '.png', g)


def create_benign_imgset():
    created = 0
    failed = 0
    for path, subdirs, files in os.walk("C:/"):
        for name in files:
            if name.endswith("exe"):
                try:
                    make_byteplot_im(os.path.join(path, name),name)
                    created +=1
                except:
                    failed += 1
                    continue
    print("Finished creating benign imgset with {} total images and {} failures".format(created,failed))


if __name__ == "__main__":
    create_benign_imgset()
